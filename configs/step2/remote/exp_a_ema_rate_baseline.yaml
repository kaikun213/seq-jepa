# Experiment A: EMA + Coding-Rate Regularizer (Remote Baseline - CIFAR-100)
# Purpose: Full baseline reproduction with rate loss on paper-aligned dataset

run:
  name: step2-exp-a-ema-rate-baseline-remote
  seed: 42
  device: auto
  mps_fallback: true
  epochs: 30
  output_dir: runs/step2/remote/exp-a-ema-rate-baseline
  drop_last: true

dataset:
  name: cifar100_aug
  data_root: data
  seq_len: 3
  download: true
  aug: true
  no_blur: false
  action_norm: true
  use_rel_latents: false
  subset_train: 50000
  subset_val: 10000
  subset_seed: 42
  batch_size: 128
  num_workers: 4

model:
  img_size: 32
  n_channels: 3
  ema: true
  ema_decay: 0.996
  teacherless: false
  pred_hidden: 1024
  num_heads: 4
  num_enc_layers: 3
  act_cond: 1
  learn_act_emb: 1
  act_latentdim: 9
  act_projdim: 128
  cifar_resnet: true
  sharpening_enabled: false
  symmetric: false

loss:
  rate_loss_enabled: true
  lambda_rate: 0.01
  alpha: 1.0
  rate_target: agg_out
  rate_use_stable: false

optim:
  lr: 0.001
  weight_decay: 0.0
  probe_lr: 0.001

eval:
  latent_type: aug
  eval_type: aug
  subspace_enabled: true
  subspace_frequency: 5        # Every 5 epochs
  subspace_viz: true

logging:
  wandb:
    enabled: true
    project: seq-jepa-streaming
    group: step2-exp-a-remote
    mode: online

gating:
  # CIFAR-100 has 100 classes, so lower accuracy thresholds
  linacc_test_min: 5.0
  r2_test_min: 0.05
  leakage_linacc_gap_min: 0.0
  leakage_r2_gap_min: 0.0
  gap_action_min: 0.05
  gap_class_min: 5.0
  # Full subspace gates
  inv_error_inv_max: 0.2
  subspace_overlap_max: 0.1
  # Collapse detection
  rank_eq_eff_min: 10
  rank_inv_eff_min: 10

